<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.api.auth.mapper.RefreshTokenMapper">

  <select id="selectByToken" resultType="com.example.api.auth.model.RefreshToken"> SELECT * FROM
    refresh_token WHERE token = #{token} </select>

  <update id="revokeAllByUserId"> UPDATE refresh_token SET revoked = true WHERE user_id = #{userId}
    AND revoked = false </update>

  <select id="countByTokenAndRevokedFalse" resultType="int"> SELECT COUNT(*) FROM refresh_token
    WHERE token = #{token} AND revoked = false </select>

  <insert id="insert" parameterType="com.example.api.auth.model.RefreshToken"> INSERT INTO
    refresh_token (user_id, token, expiry_date, revoked) VALUES (#{user.id}, #{token},
    #{expiryDate}, #{revoked}) </insert>

  <delete id="delete" parameterType="com.example.api.auth.model.RefreshToken"> DELETE FROM
    refresh_token WHERE token = #{token} </delete>

</mapper>